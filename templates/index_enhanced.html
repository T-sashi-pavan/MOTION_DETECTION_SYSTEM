<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ðŸŽ¯ Motion Detection System</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
      color: white;
      margin: 0;
      padding: 0;
      text-align: center;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      background: rgba(0, 0, 0, 0.4);
      padding: 20px;
      text-shadow: 1px 1px 3px black;
    }
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .video-container {
      position: relative;
      display: inline-block;
      margin: 20px 0;
    }
    canvas {
      border-radius: 10px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.4);
      max-width: 90%;
      background: #000;
    }
    .status-indicator {
      position: absolute;
      top: 15px;
      left: 15px;
      background: rgba(0, 0, 0, 0.7);
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 14px;
      z-index: 10;
      display: flex;
      align-items: center;
    }
    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 8px;
    }
    .status-active {
      background-color: #4caf50;
      box-shadow: 0 0 8px #4caf50;
    }
    .status-inactive {
      background-color: #f44336;
    }
    .stats {
      background: rgba(0,0,0,0.4);
      border-radius: 10px;
      padding: 15px;
      margin-top: 20px;
      width: 90%;
      max-width: 600px;
    }
    .stat-item {
      display: inline-block;
      margin: 10px;
      padding: 10px 20px;
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
    }
    button {
      margin: 15px;
      padding: 12px 30px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(45deg, #4caf50, #81c784);
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.3);
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    #stop {
      background: linear-gradient(45deg, #f44336, #e57373);
    }
    .detection-info {
      margin-top: 15px;
      font-size: 14px;
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <header>
    <h1>ðŸŽ¯ Motion Detection System</h1>
    <p>AI-Powered Human Detection (Client-side, Privacy Safe)</p>
  </header>

  <main>
    <div class="video-container">
      <canvas id="canvas"></canvas>
      <div class="status-indicator">
        <div class="status-dot status-inactive"></div>
        <span id="status-text">Detection Stopped</span>
      </div>
    </div>

    <div class="controls">
      <button id="start">Start Detection</button>
      <button id="stop" disabled>Stop Detection</button>
    </div>

    <div class="stats">
      <div class="stat-item"><strong>ðŸ‘¥ People Detected:</strong> <span id="peopleCount">0</span></div>
      <div class="stat-item"><strong>ðŸ“¸ Frames:</strong> <span id="frameCount">0</span></div>
      <div class="stat-item"><strong>âš¡ Intensity:</strong> <span id="motionIntensity">0</span></div>
    </div>
    
    <div class="detection-info">
      <p>Each detected person is highlighted with a green bounding box and numbered label</p>
    </div>
  </main>

  <!-- âœ… TensorFlow.js + COCO SSD Model -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.3"></script>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const startBtn = document.getElementById("start");
    const stopBtn = document.getElementById("stop");

    const peopleCountEl = document.getElementById("peopleCount");
    const frameCountEl = document.getElementById("frameCount");
    const motionIntensityEl = document.getElementById("motionIntensity");
    const statusText = document.getElementById("status-text");
    const statusDot = document.querySelector('.status-dot');

    let model = null;
    let isDetecting = false;
    let frameCount = 0;
    let stream = null;
    let video = null;

    async function setupCamera() {
      video = document.createElement('video');
      stream = await navigator.mediaDevices.getUserMedia({ 
        video: { 
          width: { ideal: 640 }, 
          height: { ideal: 480 } 
        } 
      });
      video.srcObject = stream;
      video.autoplay = true;
      video.playsInline = true;
      video.muted = true;
      
      await new Promise((resolve) => {
        video.onloadedmetadata = () => {
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          resolve();
        };
      });
    }

    async function startDetection() {
      startBtn.disabled = true;
      stopBtn.disabled = false;
      statusDot.classList.remove('status-inactive');
      statusDot.classList.add('status-active');
      statusText.textContent = 'Detection Active';

      if (!model) {
        statusText.textContent = 'Loading AI Model...';
        model = await cocoSsd.load();
        statusText.textContent = 'Detection Active';
      }

      await setupCamera();
      isDetecting = true;
      detectFrame();
    }

    function stopDetection() {
      isDetecting = false;
      startBtn.disabled = false;
      stopBtn.disabled = true;
      statusDot.classList.remove('status-active');
      statusDot.classList.add('status-inactive');
      statusText.textContent = 'Detection Stopped';
      
      if (stream) {
        stream.getTracks().forEach((t) => t.stop());
      }
      
      // Clear canvas and show message
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = 'white';
      ctx.font = '20px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('Detection Stopped', canvas.width/2, canvas.height/2);
      ctx.font = '16px Arial';
      ctx.fillText('Click "Start Detection" to begin', canvas.width/2, canvas.height/2 + 30);
      
      // Reset counters
      frameCount = 0;
      peopleCountEl.textContent = '0';
      frameCountEl.textContent = '0';
      motionIntensityEl.textContent = '0';
    }

    async function detectFrame() {
      if (!isDetecting) return;

      frameCount++;
      frameCountEl.textContent = frameCount;

      try {
        const predictions = await model.detect(video);
        
        // Clear canvas and draw video frame
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        // Filter for people with good confidence
        let people = predictions.filter((p) => p.class === "person" && p.score > 0.5);
        peopleCountEl.textContent = people.length;
        
        // Calculate motion intensity based on number of people
        motionIntensityEl.textContent = Math.min(100, Math.round(people.length * 25));

        // Draw bounding boxes for each detected person
        people.forEach((person, i) => {
          const [x, y, w, h] = person.bbox;
          
          // Draw green bounding box
          ctx.strokeStyle = "#00FF00";
          ctx.lineWidth = 3;
          ctx.strokeRect(x, y, w, h);
          
          // Draw label background
          ctx.fillStyle = "rgba(0, 0, 0, 0.7)";
          ctx.fillRect(x, y - 25, 120, 20);
          
          // Draw person label
          ctx.fillStyle = "#00FF00";
          ctx.font = "bold 14px Arial";
          ctx.fillText(`Person ${i + 1}`, x + 5, y - 10);
          
          // Draw confidence score
          ctx.fillStyle = "rgba(0, 0, 0, 0.7)";
          ctx.fillRect(x, y + h + 5, 80, 18);
          ctx.fillStyle = "#00FF00";
          ctx.font = "12px Arial";
          ctx.fillText(`${Math.round(person.score * 100)}%`, x + 5, y + h + 17);
        });

        // Update status text based on detection
        if (people.length > 0) {
          statusText.textContent = `${people.length} Person(s) Detected`;
        } else {
          statusText.textContent = 'Detection Active - No People';
        }
      } catch (error) {
        console.error("Detection error:", error);
        statusText.textContent = 'Detection Error';
      }

      // Continue detection
      if (isDetecting) {
        requestAnimationFrame(detectFrame);
      }
    }

    // Initialize with stopped state
    window.onload = function() {
      ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = 'white';
      ctx.font = '20px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('Motion Detection System', canvas.width/2, canvas.height/2 - 20);
      ctx.font = '16px Arial';
      ctx.fillText('Click "Start Detection" to begin', canvas.width/2, canvas.height/2 + 10);
    };

    startBtn.addEventListener("click", startDetection);
    stopBtn.addEventListener("click", stopDetection);
  </script>
</body>
</html>